#!/bin/bash

echo "=== Тест Graceful Shutdown с активными задачами ==="

# Запускаем клиентов с длительными задержками
echo "Запуск клиентов с длительными задержками (5-10 секунд)..."

for i in {1..3}; do
    echo "Запуск клиента $i с задержкой $((i*2+3)) секунд..."
    java -cp build/libs/Task_1J.jar ru.nsu.nocode.client.KeyClient localhost 8080 "shutdown_test_user$i" --delay $((i*2+3)) &
done

# Даем время клиентам подключиться и начать обработку
sleep 2

echo ""
echo "Теперь остановим сервер (Ctrl+C) и проверим graceful shutdown..."
echo "Сервер должен дождаться завершения активных задач или прервать их через 30 секунд."

# Оставляем скрипт запущенным для ручного тестирования
echo "Клиенты работают в фоне. Остановите сервер вручную для проверки graceful shutdown."
wait
