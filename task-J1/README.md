# Task J1: Сервер генерации ключей RSA

Микросервис для генерации пар ключей RSA по запросам клиентов с использованием TCP сокетов.

## Особенности

- Генерация 8192-битных RSA ключей
- Создание X.509 сертификатов с использованием BouncyCastle
- Поддержка множественных одновременных клиентов (100+)
- Кэширование сгенерированных ключей
- Асинхронная обработка с использованием NIO и пула потоков
- Обработка медленных клиентов и аварийных завершений

## Архитектура

- **Сервер**: Использует `java.nio.channels.Selector` для мультиплексирования I/O
- **Генерация ключей**: Выполняется в отдельном пуле потоков (настраивается)
- **Кэширование**: `ConcurrentHashMap` для хранения сгенерированных ключей
- **Обработка ошибок**: Graceful shutdown и обработка исключений

## Сборка

```bash
./gradlew shadowJar
```

## Запуск сервера

```bash
java -jar build/libs/Task_1J.jar server <port> <threads> <issuer.pem> <issuerDN>
```

Параметры:
- `port` - порт для прослушивания
- `threads` - количество потоков для генерации ключей
- `issuer.pem` - путь к приватному ключу CA для подписи
- `issuerDN` - Distinguished Name издателя сертификата

Пример:
```bash
java -jar build/libs/Task_1J.jar server 8080 4 ca.key 'CN=TestCA'
```

## Запуск клиента

```bash
java -jar build/libs/Task_1J.jar client <host> <port> <name> [--delay N] [--exit-before-read]
```

Параметры:
- `host` - адрес сервера
- `port` - порт сервера
- `name` - имя для генерации ключей
- `--delay N` - задержка в секундах перед чтением ответа
- `--exit-before-read` - завершение без чтения ответа

Примеры:
```bash
# Обычный запрос
java -jar build/libs/Task_1J.jar client localhost 8080 testuser

# С задержкой
java -jar build/libs/Task_1J.jar client localhost 8080 testuser --delay 5

# Аварийное завершение
java -jar build/libs/Task_1J.jar client localhost 8080 testuser --exit-before-read
```

## Создание тестового CA сертификата

```bash
./generate_test_ca.sh
```

Это создаст файлы `ca.key` и `ca.crt` для тестирования.

## Протокол

1. Клиент подключается к серверу
2. Клиент отправляет имя (ASCII строка, заканчивающаяся нулевым байтом)
3. Сервер генерирует пару ключей RSA (если имя новое) или возвращает кэшированный результат
4. Сервер отправляет:
   - 4 байта: длина приватного ключа в PEM формате
   - Приватный ключ в PEM формате
   - 4 байта: длина сертификата в PEM формате
   - Сертификат в PEM формате
5. Клиент сохраняет данные в файлы `<name>.key` и `<name>.crt`

## Тестирование

```bash
# Тест множественных клиентов
./test_multiple_clients.sh
```
