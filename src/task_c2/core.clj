(ns task-c2.core)

(defn sieve
  "Реализация Решета Эратосфена для бесконечной последовательности.
   Принимает последовательность чисел и возвращает ленивую последовательность простых чисел.
   
   Алгоритм:
   1. Берем первое число из последовательности (оно простое)
   2. Фильтруем все числа, кратные этому простому числу
   3. Рекурсивно применяем тот же процесс к оставшимся числам"
  [s]
  (let [p (first s)]
    (lazy-seq
      (cons p
            (sieve (remove #(zero? (mod % p)) (rest s)))))))

(def primes
  "Бесконечная последовательность простых чисел, начиная с 2.
   Использует алгоритм Решета Эратосфена с бесконечным верхним пределом.
   
   Примеры использования:
   (take 10 primes) => (2 3 5 7 11 13 17 19 23 29)
   (nth primes 0) => 2
   (nth primes 99) => 541"
  (sieve (iterate inc 2)))

(defn prime?
  "Проверяет, является ли число простым.
   Использует последовательность primes для проверки.
   
   n - число для проверки
   Возвращает true, если число простое, false в противном случае.
   
   Примеры:
   (prime? 7) => true
   (prime? 10) => false"
  [n]
  (if (< n 2)
    false
    (let [sqrt-n (Math/sqrt n)]
      (loop [primes-seq primes]
        (let [p (first primes-seq)]
          (cond
            (> p sqrt-n) true
            (zero? (mod n p)) false
            :else (recur (rest primes-seq))))))))

(defn primes-up-to
  "Возвращает все простые числа до указанного предела (включительно).
   
   limit - верхний предел
   Возвращает последовательность простых чисел <= limit.
   
   Примеры:
   (primes-up-to 20) => (2 3 5 7 11 13 17 19)"
  [limit]
  (take-while #(<= % limit) primes))

(defn nth-prime
  "Возвращает n-е простое число (нумерация с 0).
   
   n - индекс простого числа
   Возвращает n-е простое число.
   
   Примеры:
   (nth-prime 0) => 2
   (nth-prime 4) => 11
   (nth-prime 99) => 541"
  [n]
  (nth primes n))

(defn -main
  "Примеры использования последовательности простых чисел"
  [& args]
  (println "Первые 20 простых чисел:")
  (println (take 20 primes))
  (println)
  
  (println "Простые числа до 50:")
  (println (primes-up-to 50))
  (println)
  
  (println "100-е простое число (индекс 99):")
  (println (nth-prime 99))
  (println)
  
  (println "Проверка чисел на простоту:")
  (println "7 простое?" (prime? 7))
  (println "10 простое?" (prime? 10))
  (println "17 простое?" (prime? 17))
  (println "25 простое?" (prime? 25)))

